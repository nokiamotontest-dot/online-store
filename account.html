<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¸³æˆ¶ - å°å•†å“å•†åŸ</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-brand">
            <a href="index.html">ğŸª å°å•†å“å•†åŸ</a>
        </div>
        <div class="nav-links">
            <a href="index.html">é¦–é </a>
            <a href="products.html">å•†å“</a>
            <a href="cart.html">ğŸ›’ è³¼ç‰©è»Š (<span id="cart-count">0</span>)</a>
            <a href="account.html">å¸³æˆ¶</a>
        </div>
    </nav>

    <main class="main-content">
        <!-- ç™»å…¥/è¨»å†Šè¡¨å–® -->
        <div id="auth-form" class="form-container">
            <div class="tabs">
                <div class="tab active" onclick="switchTab('login')">ç™»å…¥</div>
                <div class="tab" onclick="switchTab('register')">è¨»å†Š</div>
            </div>
            
            <!-- ç™»å…¥è¡¨å–® -->
            <form id="login-form" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>éƒµç®±</label>
                    <input type="email" name="email" required placeholder="è«‹è¼¸å…¥éƒµç®±">
                </div>
                <div class="form-group">
                    <label>å¯†ç¢¼</label>
                    <input type="password" name="password" required placeholder="è«‹è¼¸å…¥å¯†ç¢¼">
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">ç™»å…¥</button>
            </form>
            
            <!-- è¨»å†Šè¡¨å–® -->
            <form id="register-form" style="display: none;" onsubmit="handleRegister(event)">
                <div class="form-group">
                    <label>å§“å</label>
                    <input type="text" name="name" required placeholder="è«‹è¼¸å…¥å§“å">
                </div>
                <div class="form-group">
                    <label>éƒµç®±</label>
                    <input type="email" name="email" required placeholder="è«‹è¼¸å…¥éƒµç®±">
                </div>
                <div class="form-group">
                    <label>å¯†ç¢¼</label>
                    <input type="password" name="password" required placeholder="è«‹è¼¸å…¥å¯†ç¢¼">
                </div>
                <div class="form-group">
                    <label>é›»è©± (é¸å¡«)</label>
                    <input type="tel" name="phone" placeholder="è«‹è¼¸å…¥é›»è©±">
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">è¨»å†Š</button>
            </form>
        </div>
        
        <!-- ç”¨æˆ¶ä¸­å¿ƒ -->
        <div id="user-dashboard" style="display: none;">
            <h2>æ­¡è¿å›ä¾†ï¼Œ<span id="user-name"></span>ï¼</h2>
            
            <div class="tabs">
                <div class="tab active" onclick="switchUserTab('orders')">æˆ‘çš„è¨‚å–®</div>
                <div class="tab" onclick="switchUserTab('profile')">å€‹äººè³‡æ–™</div>
            </div>
            
            <!-- è¨‚å–®åˆ—è¡¨ -->
            <div id="user-orders">
                <!-- è¨‚å–®ç”± JavaScript è¼‰å…¥ -->
            </div>
            
            <!-- å€‹äººè³‡æ–™ -->
            <div id="user-profile" style="display: none;">
                <div class="form-container" style="max-width: 100%;">
                    <h3>å€‹äººè³‡æ–™</h3>
                    <form onsubmit="updateProfile(event)">
                        <div class="form-group">
                            <label>å§“å</label>
                            <input type="text" id="profile-name" required>
                        </div>
                        <div class="form-group">
                            <label>éƒµç®±</label>
                            <input type="email" id="profile-email" required readonly>
                        </div>
                        <div class="form-group">
                            <label>é›»è©±</label>
                            <input type="tel" id="profile-phone">
                        </div>
                        <button type="submit" class="btn btn-primary">æ›´æ–°è³‡æ–™</button>
                    </form>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <p>&copy; 2025 å°å•†å“å•†åŸ. All Rights Reserved.</p>
    </footer>

    <script src="js/app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
            
            // æª¢æŸ¥ URL åƒæ•¸
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('mode') === 'register') {
                switchTab('register');
            }
        });

        function switchTab(tab) {
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');
            const tabs = document.querySelectorAll('#auth-form .tab');
            
            if (tab === 'login') {
                loginForm.style.display = 'block';
                registerForm.style.display = 'none';
                tabs[0].classList.add('active');
                tabs[1].classList.remove('active');
            } else {
                loginForm.style.display = 'none';
                registerForm.style.display = 'block';
                tabs[0].classList.remove('active');
                tabs[1].classList.add('active');
            }
        }

        function checkAuth() {
            if (DB.currentUser) {
                document.getElementById('auth-form').style.display = 'none';
                document.getElementById('user-dashboard').style.display = 'block';
                document.getElementById('user-name').textContent = DB.currentUser.name;
                document.getElementById('profile-name').value = DB.currentUser.name;
                document.getElementById('profile-email').value = DB.currentUser.email;
                document.getElementById('profile-phone').value = DB.currentUser.phone || '';
                renderUserOrders();
            } else {
                document.getElementById('auth-form').style.display = 'block';
                document.getElementById('user-dashboard').style.display = 'none';
            }
        }

        function switchUserTab(tab) {
            const ordersTab = document.getElementById('user-orders');
            const profileTab = document.getElementById('user-profile');
            const tabs = document.querySelectorAll('#user-dashboard .tab');
            
            if (tab === 'orders') {
                ordersTab.style.display = 'block';
                profileTab.style.display = 'none';
                tabs[0].classList.add('active');
                tabs[1].classList.remove('active');
            } else {
                ordersTab.style.display = 'none';
                profileTab.style.display = 'block';
                tabs[0].classList.remove('active');
                tabs[1].classList.add('active');
            }
        }

        function renderUserOrders() {
            const orders = renderOrders();
            const container = document.getElementById('user-orders');
            
            if (orders.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“¦</div>
                        <h3>é‚„æ²’æœ‰è¨‚å–®</h3>
                        <p>å»å•†åº—é€›é€›å§ï¼</p>
                        <a href="products.html" class="btn btn-primary" style="margin-top: 1rem;">é–‹å§‹è³¼ç‰©</a>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = orders.map(order => `
                <div class="order-card">
                    <div class="order-header">
                        <div>
                            <strong>è¨‚å–®ç·¨è™Ÿ: ${order.id}</strong>
                            <p style="color: var(--text-secondary); font-size: 0.875rem;">${formatDate(order.createdAt)}</p>
                        </div>
                        <span class="order-status status-${order.status}">${getStatusText(order.status)}</span>
                    </div>
                    <div class="order-items">
                        ${order.items.map(item => `
                            <p>${item.productName} x ${item.quantity}</p>
                        `).join('')}
                    </div>
                    <div class="order-total" style="text-align: right; margin-top: 1rem; font-weight: 700;">
                        ç¸½è¨ˆ: ${formatPrice(order.finalTotal)}
                    </div>
                </div>
            `).join('');
        }

        function updateProfile(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            
            DB.currentUser.name = formData.get('name');
            DB.currentUser.phone = formData.get('phone');
            
            // æ›´æ–° users æ•¸çµ„
            const index = DB.users.findIndex(u => u.id === DB.currentUser.id);
            if (index !== -1) {
                DB.users[index] = DB.currentUser;
                DB.saveUsers();
            }
            
            DB.saveCurrentUser();
            document.getElementById('user-name').textContent = DB.currentUser.name;
            showNotification('å€‹äººè³‡æ–™å·²æ›´æ–°');
        }
    </script>
</body>
</html>
