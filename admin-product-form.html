<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ·»åŠ /ç·¨è¼¯å•†å“ - å°å•†å“å•†åŸ</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-brand">
            <a href="admin.html">âš™ï¸ å¾Œå°ç®¡ç†</a>
        </div>
        <div class="nav-links">
            <a href="admin.html">è¿”å›å¾Œå°</a>
        </div>
    </nav>

    <main class="main-content">
        <div class="form-container" style="max-width: 800px;">
            <h2 id="page-title">æ·»åŠ æ–°å•†å“</h2>
            
            <form id="product-form" onsubmit="saveProduct(event)">
                <input type="hidden" id="product-id">
                
                <div class="form-group">
                    <label>å•†å“åç¨± *</label>
                    <input type="text" id="product-name" required placeholder="è«‹è¼¸å…¥å•†å“åç¨±">
                </div>
                
                <div class="form-group">
                    <label>å•†å“åˆ†é¡ *</label>
                    <select id="product-category" required>
                        <option value="">è«‹é¸æ“‡åˆ†é¡</option>
                        <option value="ç”Ÿæ´»ç”¨å“">ç”Ÿæ´»ç”¨å“</option>
                        <option value="æ–‡å…·ç”¨å“">æ–‡å…·ç”¨å“</option>
                        <option value="é£¾å“é…ä»¶">é£¾å“é…ä»¶</option>
                        <option value="å‰µæ„å•†å“">å‰µæ„å•†å“</option>
                    </select>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label>å”®åƒ¹ *</label>
                        <input type="number" id="product-price" required placeholder="è«‹è¼¸å…¥å”®åƒ¹" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label>åŸåƒ¹ (é¸å¡«)</label>
                        <input type="number" id="product-original-price" placeholder="å¦‚æœ‰æŠ˜æ‰£è«‹è¼¸å…¥åŸåƒ¹" min="0">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>åº«å­˜æ•¸é‡</label>
                    <input type="number" id="product-stock" value="0" min="0">
                </div>
                
                <div class="form-group">
                    <label>å•†å“åœ–ç¤º</label>
                    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 0.5rem;">
                        ${['â˜•','ğŸ““','ğŸ“¿','ğŸª´','ğŸ”–','ğŸ•¶ï¸','ğŸ’¡','ğŸ','ğŸ§¸','ğŸ','ğŸ€','ğŸ’„','ğŸ‘›','ğŸ§','âŒš','ğŸ”‘','ğŸ’¼','ğŸ’','ğŸ•¯ï¸','ğŸª£'].map(emoji => `
                            <button type="button" class="emoji-btn" onclick="selectEmoji('${emoji}')" style="font-size: 1.5rem; padding: 0.5rem; border: 2px solid transparent; background: none; cursor: pointer;">${emoji}</button>
                        `).join('')}
                    </div>
                    <input type="hidden" id="product-image" value="ğŸ“¦">
                </div>
                
                <div class="form-group">
                    <label>å•†å“æè¿° *</label>
                    <textarea id="product-description" rows="4" required placeholder="è«‹è¼¸å…¥å•†å“æè¿°"></textarea>
                </div>
                
                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                        <input type="checkbox" id="product-featured">
                        <span>è¨­ç‚ºç†±é–€å•†å“</span>
                    </label>
                </div>
                
                <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                    <button type="submit" class="btn btn-primary">ä¿å­˜å•†å“</button>
                    <a href="admin.html" class="btn btn-secondary">å–æ¶ˆ</a>
                </div>
            </form>
        </div>
    </main>

    <script src="js/app.js"></script>
    <script>
        let isEditing = false;
        let editingProductId = null;

        document.addEventListener('DOMContentLoaded', function() {
            checkAdmin();
            
            const urlParams = new URLSearchParams(window.location.search);
            editingProductId = parseInt(urlParams.get('id'));
            
            if (editingProductId) {
                isEditing = true;
                loadProduct(editingProductId);
            }
        });

        function selectEmoji(emoji) {
            document.getElementById('product-image').value = emoji;
            document.querySelectorAll('.emoji-btn').forEach(btn => {
                btn.style.borderColor = btn.textContent === emoji ? 'var(--primary-color)' : 'transparent';
            });
        }

        function loadProduct(id) {
            const product = getProduct(id);
            if (!product) {
                window.location.href = 'admin.html';
                return;
            }
            
            document.getElementById('page-title').textContent = 'ç·¨è¼¯å•†å“';
            document.getElementById('product-id').value = product.id;
            document.getElementById('product-name').value = product.name;
            document.getElementById('product-category').value = product.category;
            document.getElementById('product-price').value = product.price;
            document.getElementById('product-original-price').value = product.originalPrice || '';
            document.getElementById('product-stock').value = product.stock;
            document.getElementById('product-image').value = product.image;
            document.getElementById('product-description').value = product.description;
            document.getElementById('product-featured').checked = product.featured || false;
            
            selectEmoji(product.image);
        }

        function saveProduct(event) {
            event.preventDefault();
            
            const product = {
                name: document.getElementById('product-name').value,
                category: document.getElementById('product-category').value,
                price: parseInt(document.getElementById('product-price').value),
                originalPrice: parseInt(document.getElementById('product-original-price').value) || null,
                stock: parseInt(document.getElementById('product-stock').value) || 0,
                image: document.getElementById('product-image').value || 'ğŸ“¦',
                description: document.getElementById('product-description').value,
                featured: document.getElementById('product-featured').checked
            };
            
            if (isEditing) {
                product.id = editingProductId;
                DB.updateProduct(editingProductId, product);
                showNotification('å•†å“å·²æ›´æ–°');
            } else {
                DB.addProduct(product);
                showNotification('å•†å“å·²æ·»åŠ ');
            }
            
            window.location.href = 'admin.html';
        }
    </script>
    
    <style>
        .emoji-btn:hover {
            transform: scale(1.2);
        }
    </style>
</body>
</html>
